---
services:
  ai-codereview:
    build: .
    container_name: gitea-ai-codereview
    restart: always
    env_file: .env
    networks:
      gitea_gitea:
    ports:
      - "3008:3008"
    environment:
      # Gitea Configuration (Required)
      - GITEA_HOST=http://server:3000
      - GITEA_TOKEN=${GITEA_TOKEN}

      # LLM Configuration (At least one required: LLM_API_KEY, OPENAI_KEY, or COPILOT_TOKEN)
      - LLM_API_KEY=${LLM_API_KEY}
      - LLM_BASE_URL=${LLM_BASE_URL}
      - LLM_MODEL=${LLM_MODEL:-gpt-4}
      - LLM_PROVIDER=${LLM_PROVIDER:-openai}

      # Legacy LLM Authentication (for backward compatibility)
      - OPENAI_KEY=${OPENAI_KEY}
      - COPILOT_TOKEN=${COPILOT_TOKEN}

      # Application Settings
      - IGNORED_FILE_SUFFIX=${IGNORED_FILE_SUFFIX:-.json,.md,.lock}
    extra_hosts:
      - "host.docker.internal:host-gateway" # Helps access host services if needed
    volumes:
      # Hot-reload for development (changes on host reflect immediately in container)
      - ./main.py:/app/main.py
      - ./prompts:/app/prompts

networks:
  gitea_gitea:
    external: true
