# =============================================================================
# CortexReview Platform - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your values
# DO NOT commit .env to version control

# -----------------------------------------------------------------------------
# Git Platform Configuration
# -----------------------------------------------------------------------------
# Gitea Configuration (Required for Gitea support)
GITEA_TOKEN=your_gitea_token_here
GITEA_HOST=http://server:3000

# GitHub Configuration (Optional - for GitHub support)
GITHUB_TOKEN=ghp_your_github_token_here

# Platform selection: github, gitea, or both (default: gitea)
PLATFORM=gitea

# -----------------------------------------------------------------------------
# LLM Configuration (At least one authentication method required)
# -----------------------------------------------------------------------------
# Primary LLM API key (recommended - highest priority)
LLM_API_KEY=

# Custom LLM endpoint URL (for local LLMs or enterprise proxies)
# Examples:
#   - OpenAI: https://api.openai.com/v1
#   - Azure: https://your-resource.openai.azure.com/openai/deployments/your-deployment
#   - Ollama: http://localhost:11434/v1
#   - LocalAI: http://localhost:8080/v1
LLM_BASE_URL=

# Model identifier for LLM requests
LLM_MODEL=gpt-4

# Embedding model for RAG context retrieval
EMBEDDING_MODEL=text-embedding-3-small

# Response language locale for code reviews (default: en_us)
# Examples: en, en_us, zh-cn, es, fr, de, ja, ko
LLM_LOCALE=en_us

# Provider identifier for logging/auditing
LLM_PROVIDER=openai

# -----------------------------------------------------------------------------
# Legacy LLM Authentication (Fallback - for backward compatibility)
# -----------------------------------------------------------------------------
# Legacy OpenAI API key (deprecated - use LLM_API_KEY instead)
OPENAI_KEY=

# Legacy Copilot authentication token
COPILOT_TOKEN=

# -----------------------------------------------------------------------------
# Celery Configuration (Phase 2 - Async Processing)
# -----------------------------------------------------------------------------
# Celery broker URL (Redis connection string)
CELERY_BROKER_URL=redis://redis:6379/0

# Celery result backend URL (Redis connection string)
CELERY_RESULT_BACKEND=redis://redis:6379/0

# -----------------------------------------------------------------------------
# Supabase Configuration (Phase 2 - Vector Database)
# -----------------------------------------------------------------------------
# Supabase project URL (for external Supabase - optional)
# SUPABASE_URL=https://xxxxx.supabase.co

# Supabase service role key (for external Supabase - optional)
# SUPABASE_SERVICE_KEY=your_supabase_service_role_key

# Direct PostgreSQL connection string (for local Supabase Docker - recommended)
# Format: postgresql://postgres:${POSTGRES_PASSWORD}@supabase-db:5432/${POSTGRES_DB}
SUPABASE_DB_URL=postgresql://postgres:your_secure_password_here@supabase-db:5432/supabase

# -----------------------------------------------------------------------------
# Local Supabase Docker Configuration (Self-Hosted)
# -----------------------------------------------------------------------------
# PostgreSQL database password (minimum 16 characters, required for local Supabase)
POSTGRES_PASSWORD=your_secure_password_here_min_16_chars

# PostgreSQL database name (default: supabase)
POSTGRES_DB=supabase

# JWT secret for Supabase authentication (minimum 64 characters, required)
# Generate with: openssl rand -base64 64
JWT_SECRET=your_jwt_secret_here_minimum_64_characters_required_for_secure_tokens

# Anonymous key for Supabase Auth (generate from JWT_SECRET using Supabase CLI)
ANON_KEY=your_anon_key_here_generate_with_jwt_secret

# Service role key for Supabase admin operations (generate from JWT_SECRET)
SERVICE_ROLE_KEY=your_service_role_key_here_generate_with_jwt_secret

# -----------------------------------------------------------------------------
# Webhook Signature Verification (Phase 2)
# -----------------------------------------------------------------------------
# GitHub webhook secret for HMAC-SHA256 signature verification
PLATFORM_GITHUB_WEBHOOK_SECRET=whsec_your_github_webhook_secret

# Gitea webhook secret for HMAC-SHA256 signature verification
PLATFORM_GITEA_WEBHOOK_SECRET=whsec_your_gitea_webhook_secret

# Enable/disable webhook signature verification (default: true)
PLATFORM_GITHUB_VERIFY_SIGNATURE=true
PLATFORM_GITEA_VERIFY_SIGNATURE=true

# -----------------------------------------------------------------------------
# RAG Configuration (Phase 2 - Context-Aware Reviews)
# -----------------------------------------------------------------------------
# RAG similarity threshold for context matching (0.0-1.0, default: 0.75)
RAG_THRESHOLD=0.75

# RAG match count range (3-10, dynamic based on diff size)
RAG_MATCH_COUNT_MIN=3
RAG_MATCH_COUNT_MAX=10

# -----------------------------------------------------------------------------
# RLHF Configuration (Phase 2 - Learning Loop)
# -----------------------------------------------------------------------------
# RLHF similarity threshold for constraint matching (0.0-1.0, default: 0.8)
RLHF_THRESHOLD=0.8

# Enable/disable feedback processing (default: true)
FEEDBACK_ENABLED=true

# Learned constraint expiration in days (default: 90)
CONSTRAINT_EXPIRATION_DAYS=90

# -----------------------------------------------------------------------------
# Observability Configuration (Phase 2)
# -----------------------------------------------------------------------------
# Enable Prometheus metrics endpoint (default: true)
ENABLE_PROMETHEUS=true

# Enable Grafana dashboards (default: true)
ENABLE_GRAFANA=true

# -----------------------------------------------------------------------------
# Application Settings
# -----------------------------------------------------------------------------
# Comma-separated file extensions to skip during code review
IGNORED_FILE_SUFFIX=.json,.md,.lock

# -----------------------------------------------------------------------------
# Optional Notification Webhook
# -----------------------------------------------------------------------------
# Webhook URL for notifications (optional)
WEBHOOK_URL=

# Custom header name for webhook notifications
WEBHOOK_HEADER_NAME=

# Custom header value for webhook notifications
WEBHOOK_HEADER_VALUE=

# JSON template for webhook payload (supports {content} and {mention} placeholders)
WEBHOOK_REQUEST_BODY=
